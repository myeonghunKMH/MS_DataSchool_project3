<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ì‹¤ì‹œê°„ ì•”í˜¸í™”í ëª¨ì˜íˆ¬ì | ITC</title>
    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="css/common.css" />
    <link rel="stylesheet" href="css/realtime.css" />
    <link rel="stylesheet" href="css/chat-widget.css" />
    <link rel="stylesheet" href="css/tutorial.css" />
    <!-- TradingView Lightweight Charts -->
    <script src="https://unpkg.com/lightweight-charts@5.0.0/dist/lightweight-charts.standalone.production.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
      :root {
        color-scheme: dark;
        --accent: #ffd166;
        --stroke: #2b2b2b;
        --glow: 255, 255, 255;
      }

      /* ===== Global ===== */
      html,
      body {
        min-height: 100%;
      }
      body {
        margin: 0;
        color: #eaeaea;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        background: radial-gradient(
            1200px 600px at 50% -10%,
            rgba(255, 255, 255, 0.12),
            transparent 60%
          ),
          radial-gradient(
            900px 600px at 50% 120%,
            rgba(255, 255, 255, 0.08),
            transparent 60%
          ),
          repeating-linear-gradient(
            to bottom,
            rgba(255, 255, 255, 0.03) 0 2px,
            rgba(0, 0, 0, 0) 2px 8px
          ),
          linear-gradient(#151515, #0a0a0a);
        background-attachment: fixed;
      }
      * {
        box-sizing: border-box;
      }

      /* ===== Header ===== */
      header {
        position: fixed;
        inset: 12px 12px auto 12px;
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: space-between;
        backdrop-filter: saturate(120%) blur(2px);
      }
      .brand img {
        width: 120px;
        height: auto;
        filter: drop-shadow(0 10px 26px rgba(var(--glow), 0.22))
          drop-shadow(0 0 20px rgba(var(--glow), 0.18));
      }
      nav {
        display: flex;
        gap: 8px;
      }
      .navbtn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        height: 36px;
        padding: 0 12px;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid var(--stroke);
        color: #f3f3f3;
        text-decoration: none;
        font-weight: 700;
        transition: 0.22s;
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
      }
      .navbtn img {
        width: 18px;
        height: 18px;
        object-fit: contain;
        display: block;
      }
      .navbtn:hover {
        border-color: rgba(var(--glow), 0.32);
        box-shadow: 0 0 12px rgba(var(--glow), 0.22);
        transform: translateY(-1px);
        color: #fff;
      }

      /* ===== Layout ===== */
      main {
        width: min(1400px, 92vw);
        margin: 100px auto 48px;
        display: flex;
        flex-direction: column;
        gap: 22px;
      }


      /* ===== Trading Container ===== */
      .trading-container {
        background: #1a1a1a;
        border: 1px solid var(--stroke);
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3),
          inset 0 1px 0 rgba(255, 255, 255, 0.05);
        position: relative;
      }


      /* ===== Footer ===== */
      footer {
        display: flex;
        justify-content: center;
        margin: 50px 0 160px;
        color: #9a9a9a;
        font-size: 12px;
        text-align: center;
        line-height: 1.4;
        padding: 0 16px;
      }
      html, body {
        overflow-y: scroll;  /* ìŠ¤í¬ë¡¤ì€ ê°€ëŠ¥í•˜ê²Œ ìœ ì§€ */
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE, êµ¬ Edge */
      }

      html::-webkit-scrollbar,
      body::-webkit-scrollbar {
        display: none; /* Chrome, Safari, ì‹  Edge */
      }
    </style>
  </head>
  <body>
    <header>
      <a class="brand" href="index.html"
        ><img src="/images/logo.png" alt="ITC ë¡œê³ "
      /></a>
      <nav>
        <a class="navbtn" href="guide.html"
          ><img src="/images/Document.png" alt="" />GUIDE</a
        >
        <a class="navbtn" href="mypage.html">MyPage</a>
        <a class="navbtn" href="index.html">â† Back</a>
      </nav>
    </header>

    <main>
      <!-- íŠ¸ë ˆì´ë”© ì»¨í…ì¸  ì¹´ë“œ -->
      <div class="trading-container">
        <div class="header-summary" id="coin-summary"></div>

        <div class="top-chart-section">
          <div class="chart-controls">
            <div class="coin-tabs" id="coin-tabs"></div>
            <!-- ì§€í‘œ ë° ì°¨íŠ¸ ì„¤ì • ë“œë¡­ë‹¤ìš´ë“¤ -->
            <div class="indicator-controls">
              <div class="dropdown-container">
                <button class="indicator-btn" id="ma-toggle">
                  ì´ë™í‰ê· ì„  â–¼
                </button>
                <div class="indicator-panel hidden" id="ma-panel">
                  <label><input type="checkbox" data-ma="5" /> MA5</label>
                  <label><input type="checkbox" data-ma="10" /> MA10</label>
                  <label><input type="checkbox" data-ma="20" /> MA20</label>
                  <label><input type="checkbox" data-ma="50" /> MA50</label>
                  <label><input type="checkbox" data-ma="100" /> MA100</label>
                  <label><input type="checkbox" data-ma="200" /> MA200</label>
                </div>
              </div>
              <div class="dropdown-container">
                <button class="indicator-btn" id="technical-toggle">
                  ë³´ì¡°ì§€í‘œ â–¼
                </button>
                <div class="indicator-panel hidden" id="technical-panel">
                  <label
                    ><input type="checkbox" data-indicator="RSI" /> RSI</label
                  >
                  <label
                    ><input type="checkbox" data-indicator="MACD" /> MACD</label
                  >
                  <label
                    ><input type="checkbox" data-indicator="BB" />
                    ë³¼ë¦°ì €ë°´ë“œ</label
                  >
                </div>
              </div>
              <button
                class="indicator-btn"
                id="clear-all-indicators"
                title="ëª¨ë“  ì§€í‘œ ì´ˆê¸°í™”"
              >
                ì´ˆê¸°í™”
              </button>
            </div>
            <!-- ì‹œê°„ë‹¨ìœ„ ì„ íƒ -->
            <div class="time-controls">
              <div class="dropdown-container">
                <button class="indicator-btn" id="timeframe-toggle">
                  1ì‹œê°„ â–¼
                </button>
                <div class="indicator-panel hidden" id="timeframe-panel">
                  <label><input type="radio" name="timeframe" value="1" /> 1ë¶„</label>
                  <label><input type="radio" name="timeframe" value="5" /> 5ë¶„</label>
                  <label><input type="radio" name="timeframe" value="15" /> 15ë¶„</label>
                  <label><input type="radio" name="timeframe" value="30" /> 30ë¶„</label>
                  <label class="selected"><input type="radio" name="timeframe" value="60" checked /> 1ì‹œê°„</label>
                  <label><input type="radio" name="timeframe" value="240" /> 4ì‹œê°„</label>
                  <label><input type="radio" name="timeframe" value="1D" /> 1ì¼</label>
                </div>
              </div>
            </div>
          </div>

          <div class="chart-container">
            <div id="priceChart" class="chart-section price-chart"></div>

            <!-- RSI ì°¨íŠ¸ (ì´ˆê¸° ìˆ¨ê¹€) -->
            <div
              id="rsiChart"
              class="chart-section indicator-chart hidden"
              data-indicator="RSI"
            >
              <div class="chart-content"></div>
            </div>

            <!-- MACD ì°¨íŠ¸ (ì´ˆê¸° ìˆ¨ê¹€) -->
            <div
              id="macdChart"
              class="chart-section indicator-chart hidden"
              data-indicator="MACD"
            >
              <div class="chart-content"></div>
            </div>

            <div id="volumeChart" class="chart-section volume-chart"></div>
          </div>
        </div>

        <div class="bottom-content">
          <div class="orderbook-wrapper">
            <div class="orderbook-tab-group">
              <button id="toggle-general" class="tab-button active">
                ì¼ë°˜ í˜¸ê°€
              </button>
              <button id="toggle-grouped" class="tab-button">ëˆ„ì  í˜¸ê°€</button>
              <button class="tab-button disabled">í˜¸ê°€ì£¼ë¬¸</button>
            </div>

            <!-- ì „ì²´ í˜¸ê°€ì°½ ì»¨í…Œì´ë„ˆ -->
            <div class="orderbook-container">
              <!-- ì‹¤ì œ í˜¸ê°€ì°½ (íƒ­ ì „í™˜ì— ë”°ë¼ ë‚´ìš© ë³€ê²½) -->
              <div class="orderbook-section">
                <!-- ì¼ë°˜ í˜¸ê°€ì°½ ë‚´ìš© -->
                <div id="general-orderbook-content" class="orderbook-content">
                  <div
                    class="orderbook-list unified-list"
                    id="general-unified-list"
                  ></div>
                </div>

                <!-- ëˆ„ì  í˜¸ê°€ì°½ ë‚´ìš© -->
                <div
                  id="cumulative-orderbook-content"
                  class="orderbook-content hidden"
                >
                  <!-- ëˆ„ì  í˜¸ê°€ ë¦¬ìŠ¤íŠ¸ -->
                  <div
                    id="cumulative-orderbook-list"
                    class="cumulative-orderbook-scroll orderbook-list"
                  ></div>
                </div>
              </div>

              <!-- ì²´ê²°ê°•ë„ í‘œì‹œ -->
              <div class="market-pressure">
                <div class="pressure-bar">
                  <div class="ask-pressure" id="ask-pressure-bar"></div>
                  <div class="bid-pressure" id="bid-pressure-bar"></div>
                </div>
                <div class="pressure-labels">
                  <span class="ask-label">ë§¤ë„ì••ë ¥</span>
                  <span class="pressure-ratio" id="pressure-ratio">50:50</span>
                  <span class="bid-label">ë§¤ìˆ˜ì••ë ¥</span>
                </div>
              </div>
            </div>
          </div>
          <div class="trading-panel">
            <div class="trading-tabs">
              <button class="trading-tab active" data-side="bid">ë§¤ìˆ˜</button>
              <button class="trading-tab" data-side="ask">ë§¤ë„</button>
            </div>
            <div class="trading-content">
              <div class="balance-and-type">
                <div class="available-balance">
                  <span>ì£¼ë¬¸ê°€ëŠ¥</span>
                  <span id="available-amount" class="available-amount-value"
                    >0 KRW</span
                  >
                </div>
                <div class="trading-type">
                  <button class="trading-type-btn active" data-type="limit">
                    ì§€ì •ê°€
                  </button>
                  <button class="trading-type-btn" data-type="market">
                    ì‹œì¥ê°€
                  </button>
                  <button class="trading-type-btn disabled">ì˜ˆì•½</button>
                </div>
              </div>
              <div class="trading-input-group price-input-group">
                <label for="order-price">ì£¼ë¬¸ê°€</label>
                <input type="text" id="order-price" placeholder="0" />
                <div class="price-controls">
                  <select id="price-percentage-dropdown"></select>
                  <button class="price-btn minus">-</button>
                  <button class="price-btn plus">+</button>
                </div>
              </div>
              <div class="trading-input-group quantity-input-group">
                <label for="order-quantity">ì£¼ë¬¸ìˆ˜ëŸ‰</label>
                <input type="text" id="order-quantity" placeholder="0" />
                <div class="quantity-btns">
                  <button data-percent="10">10%</button>
                  <button data-percent="25">25%</button>
                  <button data-percent="50">50%</button>
                  <button data-percent="100">ìµœëŒ€</button>
                </div>
              </div>
              <div class="trading-input-group total-input-group">
                <label for="order-total">ì£¼ë¬¸ì´ì•¡</label>
                <input type="text" id="order-total" placeholder="0" />
              </div>
              <div class="trading-input-group market-total-group hidden">
                <label for="order-total-market">ì£¼ë¬¸ì´ì•¡</label>
                <input type="text" id="order-total-market" placeholder="0" />
                <div class="quantity-btns">
                  <button data-percent="10">10%</button>
                  <button data-percent="25">25%</button>
                  <button data-percent="50">50%</button>
                  <button data-percent="100">ìµœëŒ€</button>
                </div>
              </div>
              <button class="trade-button bid-button">ë§¤ìˆ˜</button>
              <button class="trade-button ask-button hidden">ë§¤ë„</button>
            </div>
            <div class="trade-history-container">
              <div class="tabs">
                <button id="pending-orders-tab" class="tab-button active">
                  ëŒ€ê¸° ì£¼ë¬¸
                </button>
                <button id="filled-orders-tab" class="tab-button">
                  ì²´ê²° ë‚´ì—­
                </button>
                <button
                  id="refresh-all-orders"
                  class="tab-button refresh-tab"
                  title="ì „ì²´ ìƒˆë¡œê³ ì¹¨"
                >
                  <img src="images/refresh.png" alt="ìƒˆë¡œê³ ì¹¨" />
                </button>
              </div>
              <div id="pending-orders-section" class="tab-content">
                <div id="pending-orders-list" class="order-list"></div>
              </div>
              <div id="filled-orders-section" class="tab-content hidden">
                <div id="filled-orders-list" class="order-list"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <!-- Tutorial System Markup (from index.html) -->
    <div class="tutorial-overlay" id="tutorialOverlay"></div>
    <div class="tutorial-spotlight" id="tutorialSpotlight"></div>
    
    <div class="tutorial-mascot" id="tutorialMascot">
      <img class="mascot-img" id="mascotImg" src="/images/coin_good1.png" alt="ë§ˆìŠ¤ì½”íŠ¸">
    </div>
    
    <div class="tutorial-bubble" id="tutorialBubble">
      <h3 class="bubble-title" id="bubbleTitle"></h3>
      <p class="bubble-text" id="bubbleText"></p>
      <div class="tutorial-controls">
        <button class="tutorial-btn skip" id="skipBtn">ê±´ë„ˆë›°ê¸°</button>
        <button class="tutorial-btn next" id="nextBtn">ë‹¤ìŒ</button>
      </div>
    </div>
    
    <div class="tutorial-progress" id="tutorialProgress"></div>
    
    <button class="help-button" id="helpButton">
      <img src="/images/coin_good1.png" alt="íŠœí† ë¦¬ì–¼ ë§ˆìŠ¤ì½”íŠ¸" style="width:24px;height:24px;border-radius:50%;">
      ì‹¤ì‹œê°„ íŠœí† ë¦¬ì–¼
    </button>

    <!-- End Tutorial System Markup -->
    <!-- ì‚¬ìš©ì ì •ë³´ ë¡œë”© ìŠ¤í¬ë¦½íŠ¸ ë° ì „ì—­ ì§€í‘œí•¨ìˆ˜ (í•„ìš”ì‹œ) -->
    <script>
      // ì‚¬ìš©ì ì •ë³´ ë¡œë”©
      async function loadUserInfo() {
        try {
          const response = await fetch("/api/user");

          if (response.ok) {
            const user = await response.json();

            // ì‚­ì œ ì˜ˆì•½ ì‚¬ìš©ì ì•Œë¦¼
            if (user.deletion_cancelled) {
              alert(
                "ê³„ì • ì‚­ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤. ê³„ì† ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
              );
            }
          } else {
          }
        } catch (error) {
        }
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ì •ë³´ ë¡œë”©
      document.addEventListener("DOMContentLoaded", function () {
        loadUserInfo();
      });

      let currentIndicators = [];
      function addIndicator(type) {
        const app = window.TradingApp?.app();
        if (app?.chartManager) {
          const indicator = app.chartManager.addIndicator(type);
          if (indicator) {
            currentIndicators.push({ type, series: indicator });
          }
        }
      }
      function clearIndicators() {
        currentIndicators.forEach(({ series }) => {
          if (series && typeof series.remove === "function") {
            series.remove();
          }
        });
        currentIndicators = [];
      }
    </script>

    <script src="js/TechnicalIndicatorManager.js"></script>
    <script src="js/AIAssistant.js"></script>

    <!-- ë„ì›€ë§ ë²„íŠ¼: ì±—ë´‡ ë²„íŠ¼ ì™¼ìª½ì— í•­ìƒ ê³ ì • (ëŒ€ì¹˜í•  ìŠ¤í¬ë¦½íŠ¸) -->
    <script>
      (function () {
        const helpBtn = document.getElementById('helpButton');
        if (!helpBtn) return;

        // AI ì±—ë´‡ ë²„íŠ¼ì„ ì°¾ëŠ” ì…€ë ‰í„°ë“¤
        const CHAT_SELECTORS = [
          '#aiAssistantToggle',
          '#chatToggle',
          '#chat-widget-toggle',
          '.chat-widget-toggle',
          'button[data-role="chat-toggle"]',
          'button[id*="chat"][id*="toggle"]',
          'button[class*="chat"][class*="toggle"]'
        ];

        // ê¸°ë³¸ ê³ ì •ê°’ (íŠœí† ë¦¬ì–¼ ë²„íŠ¼ ê¸°ë³¸ ìœ„ì¹˜)
        const DEFAULT_BOTTOM_PX = 18;
        const DEFAULT_RIGHT_PX = 18;
        const GAP_PX = 12;

        function findChatButton() {
          for (const s of CHAT_SELECTORS) {
            const el = document.querySelector(s);
            if (el) return el;
          }
          // ë³´ìˆ˜ì  í›„ë³´ íƒìƒ‰: fixed í¬ì§€ì…˜ì´ë©´ì„œ í´ë˜ìŠ¤/ì•„ì´ë””ì— chat í¬í•¨ëœ ë²„íŠ¼
          const candidates = Array.from(document.querySelectorAll('button')).filter(b => {
            const st = getComputedStyle(b);
            const idc = (b.id + ' ' + b.className).toLowerCase();
            return st.position === 'fixed' && idc.includes('chat');
          });
          return candidates[0] || null;
        }

        // íŠœí† ë¦¬ì–¼ ë²„íŠ¼ì„ ê¸°ë³¸ ìœ„ì¹˜(ìš°í•˜ë‹¨)ì— ê³ ì •
        function placeHelpButton() {
          if (helpBtn.parentElement !== document.body) {
            document.body.appendChild(helpBtn);
          }
          
          helpBtn.style.position = 'fixed';
          helpBtn.style.display = 'inline-flex';
          helpBtn.style.boxSizing = 'border-box';
          helpBtn.style.left = 'auto';
          helpBtn.style.right = DEFAULT_RIGHT_PX + 'px';
          helpBtn.style.bottom = DEFAULT_BOTTOM_PX + 'px';
          helpBtn.style.top = 'auto';
          helpBtn.style.zIndex = 1000;
          helpBtn.style.visibility = 'visible';
        }

        // ì±—ë´‡ ë²„íŠ¼ì„ íŠœí† ë¦¬ì–¼ ë²„íŠ¼ ìœ„ì— ë°°ì¹˜
        function placeChatButtonAboveHelp(chatEl) {
          if (!chatEl) return false;

          // íŠœí† ë¦¬ì–¼ ë²„íŠ¼ì˜ ìœ„ì¹˜ì™€ í¬ê¸° ê°€ì ¸ì˜¤ê¸°
          const helpRect = helpBtn.getBoundingClientRect();
          const helpHeight = helpBtn.offsetHeight || 50;

          // ì±—ë´‡ ë²„íŠ¼ì„ íŠœí† ë¦¬ì–¼ ë²„íŠ¼ ë°”ë¡œ ìœ„ì— ë°°ì¹˜
          const chatBottom = Math.round(window.innerHeight - helpRect.top + GAP_PX);
          const chatRight = Math.round(window.innerWidth - helpRect.right);

          chatEl.style.position = 'fixed';
          chatEl.style.left = 'auto';
          chatEl.style.right = chatRight + 'px';
          chatEl.style.bottom = chatBottom + 'px';
          chatEl.style.top = 'auto';
          
          // z-index: íŠœí† ë¦¬ì–¼ ë²„íŠ¼ë³´ë‹¤ í•œ ë‹¨ê³„ ìœ„ë¡œ
          const helpZ = parseInt(getComputedStyle(helpBtn).zIndex || '1000', 10);
          chatEl.style.zIndex = (isNaN(helpZ) ? 1001 : (helpZ + 1));

          return true;
        }

        // ì´ˆê¸° ë°°ì¹˜ ë° ê´€ì°° ì‹œì‘
        function initPlacement() {
          // ë¨¼ì € íŠœí† ë¦¬ì–¼ ë²„íŠ¼ì„ ê¸°ë³¸ ìœ„ì¹˜ì— ê³ ì •
          placeHelpButton();

          // ì±—ë´‡ ë²„íŠ¼ ì°¾ì•„ì„œ ìœ„ì— ë°°ì¹˜
          const tryPlaceChat = () => {
            const chat = findChatButton();
            if (chat) {
              return placeChatButtonAboveHelp(chat);
            }
            return false;
          };

          // ì´ˆê¸° ì‹œë„
          if (!tryPlaceChat()) {
            // ì±—ë´‡ ë²„íŠ¼ì´ ì•„ì§ ì—†ìœ¼ë©´ ê´€ì°° ì‹œì‘
            const obs = new MutationObserver(() => {
              if (tryPlaceChat()) {
                obs.disconnect();
              }
            });
            obs.observe(document.body, { childList: true, subtree: true });
            
            // ì•ˆì „ì¥ì¹˜: 10ì´ˆ í›„ì—ë„ ì•ˆ ë‚˜íƒ€ë‚˜ë©´ ì˜µì €ë²„ ë”
            setTimeout(() => obs.disconnect(), 10000);
          }
        }

        // DOM ì¤€ë¹„ë˜ë©´ ì‹¤í–‰
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initPlacement);
        } else {
          initPlacement();
        }

        // ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ì¬ë°°ì¹˜
        window.addEventListener('resize', () => {
          placeHelpButton();
          const chat = findChatButton();
          if (chat) {
            placeChatButtonAboveHelp(chat);
          }
        });
      })();
      (function() {
      // available-amount ìš”ì†Œ ê°ì‹œ ë° localStorage ë™ê¸°í™”
      const availableAmountElement = document.getElementById('available-amount');
      
      if (availableAmountElement) {
        // ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ localStorageì— ì €ì¥
        const observer = new MutationObserver(() => {
          const currentValue = availableAmountElement.textContent.trim();
          
          // ìœ íš¨í•œ ê°’ì¸ì§€ í™•ì¸ (0 KRWê°€ ì•„ë‹ˆê³  ì‹¤ì œ ê°’ì´ ìˆì„ ë•Œ)
          if (currentValue && currentValue !== '0 KRW' && !currentValue.includes('ë¡œë”©')) {
            const balanceData = {
              available_amount: currentValue,
              updated_at: Date.now(),
              source: 'realtime_page',
              page: 'realtime'
            };
            
            localStorage.setItem('realtime_balance', JSON.stringify(balanceData));
            
            // BroadcastChannelë¡œ ì¦‰ì‹œ ì•Œë¦¼ (ë‹¤ë¥¸ íƒ­ì— ì—´ë¦° mypageìš©)
            if (typeof BroadcastChannel !== 'undefined') {
              try {
                const channel = new BroadcastChannel('realtime_balance');
                channel.postMessage(balanceData);
                channel.close();
              } catch (e) {
                // BroadcastChannel ì˜¤ë¥˜ ë¬´ì‹œ
              }
            }
            
            console.log('ğŸ’° realtime ì”ê³  ì €ì¥ë¨:', currentValue);
          }
        });
        
        // í…ìŠ¤íŠ¸ ë³€ê²½ ê°ì‹œ ì‹œì‘
        observer.observe(availableAmountElement, { 
          childList: true, 
          subtree: true, 
          characterData: true 
        });
        
        // ì´ˆê¸° ê°’ë„ ì €ì¥
        const initialValue = availableAmountElement.textContent.trim();
        if (initialValue && initialValue !== '0 KRW') {
          const initialData = {
            available_amount: initialValue,
            updated_at: Date.now(),
            source: 'realtime_page',
            page: 'realtime'
          };
          localStorage.setItem('realtime_balance', JSON.stringify(initialData));
        }
      }
      
      // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ìµœì‹  ê°’ ì €ì¥
      window.addEventListener('beforeunload', () => {
        if (availableAmountElement) {
          const finalValue = availableAmountElement.textContent.trim();
          if (finalValue && finalValue !== '0 KRW') {
            const finalData = {
              available_amount: finalValue,
              updated_at: Date.now(),
              source: 'realtime_page',
              page: 'realtime'
            };
            localStorage.setItem('realtime_balance', JSON.stringify(finalData));
          }
        }
      });
      
      // 30ì´ˆë§ˆë‹¤ í˜„ì¬ ê°’ ì €ì¥ (ì•ˆì „ì¥ì¹˜)
      setInterval(() => {
        if (availableAmountElement) {
          const currentValue = availableAmountElement.textContent.trim();
          if (currentValue && currentValue !== '0 KRW' && !currentValue.includes('ë¡œë”©')) {
            const data = {
              available_amount: currentValue,
              updated_at: Date.now(),
              source: 'realtime_page',
              page: 'realtime'
            };
            localStorage.setItem('realtime_balance', JSON.stringify(data));
          }
        }
      }, 30000);
    })();
    </script>

    <script type="module" src="js/main.js"></script>

    <footer>
      ë³¸ ì„œë¹„ìŠ¤ëŠ” í•™ìŠµê³¼ ì—°ìŠµì„ ëª©ì ìœ¼ë¡œ ì œê³µë˜ëŠ” ëª¨ì˜íˆ¬ì ì‹œìŠ¤í…œì…ë‹ˆë‹¤.<br />
      ì œê³µë˜ëŠ” ë°ì´í„°ì™€ ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ëŠ” ì‹¤ì œ ì‹œì¥ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë©°, ì´ë¡œ ì¸í•´
      ë°œìƒí•˜ëŠ” ëª¨ë“  ì†ì‹¤ê³¼ ë¶ˆì´ìµì— ëŒ€í•´ì„œ ìš´ì˜ìëŠ” ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.<br />
      ë³¸ ì„œë¹„ìŠ¤ëŠ” íˆ¬ì ê¶Œìœ ê°€ ì•„ë‹ˆë©°, ì‹¤ì œ íˆ¬ìë¥¼ ê²°ì •í•  ë•ŒëŠ” ì´ìš©ì ë³¸ì¸ì˜
      íŒë‹¨ê³¼ ì±…ì„ì— ë”°ë¼ì•¼ í•©ë‹ˆë‹¤.
    </footer>
    <!-- Tutorial System JS -->
    <script src="js/tutorial-core.js"></script>
    <script>
      const stepsRealtime = [
          {
            title: "í™˜ì˜í•©ë‹ˆë‹¤!",
            text: "ì´ í˜ì´ì§€ì—ì„œëŠ” ëª¨ì˜ë¡œ ì‹¤ì‹œê°„ ê±°ë˜ë¥¼ ì²´í—˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì°¨íŠ¸, ë³´ì¡°ì§€í‘œ ë“± ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì‚´í´ë³´ë©° ì½”ì¸íˆ¬ìì˜ ì „ì²´ íë¦„ì„ ì´í•´í•´ë³´ì„¸ìš”.",
            target: null,
            mascot: "coin_good1",
            position: "right",
            audio: "voice/1.mp3",
            scroll: { mode: "pixel", offsetPx: 0 }
          },
          {
            title: "ì½”ì¸ ì„ íƒ",
            text: "ë¹„íŠ¸ì½”ì¸, ì´ë”ë¦¬ì›€, ë¦¬í”Œ ì¤‘ ì›í•˜ëŠ” ì¢…ëª©ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„ íƒ ì‹œ í•´ë‹¹ ì½”ì¸ì˜ ì°¨íŠ¸ì™€ ì£¼ë¬¸ ì •ë³´ê°€ ìë™ìœ¼ë¡œ ê°±ì‹ ë©ë‹ˆë‹¤.",
            target: "#coin-tabs",
            mascot: "coin_good1",
            position: "right",
            audio: "voice/2.mp3",
            scroll: { mode: "pixel", offsetPx: 0 }
          },
          {
            title: "ë³´ì¡°ì§€í‘œ",
            text: "ì´ë™í‰ê· ì„ , ê±°ë˜ëŸ‰ê³¼ ê°™ì€ ë³´ì¡°ì§€í‘œë¥¼ ì°¨íŠ¸ ìœ„ì— ì¶”ê°€í•´ íë¦„ì„ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•„ìš”í•  ê²½ìš° í•œ ë²ˆì— ì´ˆê¸°í™”í•˜ì—¬ ê¹”ë”í•˜ê²Œ ì •ë¦¬í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.",
            target: ".indicator-controls",
            mascot: "coin_good1",
            position: "left",
            audio: "voice/4.mp3",
            scroll: { mode: "pixel", offsetPx: 0 }
          },
          {
            title: "ë‹¨ìœ„ì‹œê°„ ë³€ê²½",
            text: "ì´ ë²„íŠ¼ìœ¼ë¡œ 1ë¶„, 5ë¶„, 1ì‹œê°„, 1ì¼ ë‹¨ìœ„ ë“± ë‹¤ì–‘í•œ ìº”ë“¤ ì°¨íŠ¸ë¥¼ ì „í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë‹¨ê¸° ë³€ë™ë¶€í„° ì¥ê¸° ì¶”ì„¸ê¹Œì§€ í•œëˆˆì— ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            target: "#timeframe-toggle",
            mascot: "coin_good1",
            position: "left",
            audio: "voice/3b.mp3",
            scroll: { mode: "pixel", offsetPx: 0 }
          },
          {
            title: "ì°¨íŠ¸",
            text: "ë©”ì¸ ì°¨íŠ¸ì—ì„œëŠ” ì„ íƒí•œ ì½”ì¸ì˜ ê°€ê²© ë³€í™”ë¥¼ ì§ê´€ì ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹œê°„ ë‹¨ìœ„ë¥¼ ë°”ê¾¸ë©´ ë‹¨ê¸° íŠ¸ë ˆì´ë”© í˜¹ì€ ì¥ê¸° íˆ¬ìì˜ ê´€ì ì—ì„œ ì‹œì¥ íë¦„ì„ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            target: "#priceChart",
            mascot: "coin_good1",
            position: "bottom",
            audio: "voice/3.mp3",
            scroll: { mode: "pixel", offsetPx: 297 }
          },
          {
            title: "í˜¸ê°€ì°½",
            text: "ì‹¤ì‹œê°„ìœ¼ë¡œ ë§¤ìˆ˜Â·ë§¤ë„ í˜¸ê°€ê°€ ë³€ë™ë˜ëŠ” êµ¬ê°„ì…ë‹ˆë‹¤. í˜„ì¬ ì‹œì¥ì—ì„œ í˜•ì„±ë˜ëŠ” ìœ ë™ì„±ê³¼ ê°€ê²©ëŒ€ë¥¼ ë¹ ë¥´ê²Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            target: ".orderbook-container",
            mascot: "coin_good1",
            position: "right",
            audio: "voice/5.mp3",
            scroll: { mode: "pixel", offsetPx: 750 }
          },
          {
            title: "ì£¼ë¬¸ ì…ë ¥",
            text: "ê°€ê²©ê³¼ ìˆ˜ëŸ‰ì„ ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜, ì‹œì¥ê°€ë¥¼ ì„ íƒí•´ ì¦‰ì‹œ ê±°ë˜ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì›í•˜ëŠ” ì „ëµì— ë”°ë¼ ì‹ ì†í•˜ê²Œ ì£¼ë¬¸ì„ ë„£ì„ ìˆ˜ ìˆëŠ” í•µì‹¬ ê¸°ëŠ¥ì…ë‹ˆë‹¤.",
            target: ".trading-content",
            mascot: "coin_good1",
            position: "left",
            audio: "voice/6.mp3",
            scroll: { mode: "pixel", offsetPx: 750 }
          },
          {
            title: "ë§¤ìˆ˜/ë§¤ë„ ì „í™˜",
            text: "ìƒë‹¨ íƒ­ì—ì„œ â€˜ë§¤ìˆ˜ â†” ë§¤ë„â€™ë¥¼ ì „í™˜í•˜ë©´, ì•„ë˜ ì…ë ¥ í¼ê³¼ ì£¼ë¬¸ ë²„íŠ¼ì´ ì•Œë§ê²Œ ë°”ë€ë‹ˆë‹¤. ê±°ë˜ ë°©í–¥ì— ë”°ë¼ ì „í™˜í•´ ì‚¬ìš©í•˜ì„¸ìš”.",
            target: ".trading-tabs",
            mascot: "coin_good1",
            position: "bottom",
            audio: "voice/8.mp3",
            scroll: { mode: "pixel", offsetPx: 750 }
          },
          {
            title: "ë§¤ìˆ˜/ë§¤ë„ ë²„íŠ¼",
            text: "ëª¨ë“  ì…ë ¥ì´ ì™„ë£Œë˜ë©´ ì´ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹¤ì œ ì£¼ë¬¸ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. ëª¨ì˜íˆ¬ìì´ë‹ˆ ê±±ì •ë§ê³  ê±°ë˜í•˜ì„¸ìš”.",
            target: ".trade-button.bid-button",
            mascot: "coin_good1",
            position: "top",
            audio: "voice/7.mp3",
            scroll: { mode: "pixel", offsetPx: 750 }
          },
          {
            title: "ì”ê³  ë° ì£¼ë¬¸ ê°€ëŠ¥ ê¸ˆì•¡",
            text: "ì—¬ê¸°ì„œ í˜„ì¬ ê³„ì •ì— ë‚¨ì•„ ìˆëŠ” ì”ê³ ì™€ ì‹¤ì œë¡œ ì£¼ë¬¸ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê°€ëŠ¥ ê¸ˆì•¡ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê±°ë˜ ì „ì— ë°˜ë“œì‹œ ì²´í¬í•´ì•¼ í•˜ëŠ” ì¤‘ìš”í•œ ì˜ì—­ì…ë‹ˆë‹¤.",
            target: ".available-balance",
            mascot: "coin_good1",
            position: "right",
            audio: "voice/9.mp3",
            scroll: { mode: "pixel", offsetPx: 750 }
          },
          {
            title: "ì²´ê²° ë‚´ì—­",
            text: "ë‚´ê°€ ë‚¸ ì£¼ë¬¸ì´ ì²´ê²°ë˜ì—ˆëŠ”ì§€, ê·¸ë¦¬ê³  ê³¼ê±°ì— ì–´ë–¤ ê±°ë˜ê°€ ì´ë£¨ì–´ì¡ŒëŠ”ì§€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹¤ì‹œê°„ìœ¼ë¡œ ê°±ì‹ ë˜ë¯€ë¡œ ê±°ë˜ ê¸°ë¡ì„ ë¹ ë¥´ê²Œ ì¶”ì í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            target: ".trade-history-container",
            mascot: "coin_good1",
            position: "top",
            audio: "voice/10.mp3",
            scroll: { mode: "pixel", offsetPx: 750 }
          },
          {
            title: "ë§ˆë¬´ë¦¬",
            text: "íŠœí† ë¦¬ì–¼ì´ ëª¨ë‘ ëë‚¬ìŠµë‹ˆë‹¤. í•„ìš”í•  ë•ŒëŠ” ì–¸ì œë“  ë„ì›€ë§ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ì‹œ ê°€ì´ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹¤ì „ ê±°ë˜ ì „ì— ë°˜ë³µ í•™ìŠµìš©ìœ¼ë¡œë„ í™œìš©í•´ë³´ì„¸ìš”.",
            target: ".help-button",
            mascot: "coin_good1",
            position: "bottom",
            audio: "voice/11.mp3",
            scroll: { mode: "pixel", offsetPx: 0 }
          }
        ];

      const tutorial = new TutorialSystem(stepsRealtime);
    </script>
    <!-- End Tutorial System JS -->
  </body>
</html>
